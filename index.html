<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minispill | Bruk Tid</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font for better readability */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1f2937; /* Mørk bakgrunn */
            color: #f3f4f6; /* Lys tekstfarge */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1.5rem;
            box-sizing: border-box;
        }

        .container {
            background-color: #374151; /* Mørkere grå for hovedcontainer */
            border-radius: 1.5rem; /* runde hjørner */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1); /* skygge */
            padding: 2.5rem;
            width: 100%;
            max-width: 900px; /* Maks bredde for lesbarhet */
            display: flex;
            flex-direction: column;
            gap: 2rem;
        }

        header {
            text-align: center;
            margin-bottom: 1rem;
        }

        h1 {
            font-size: 3rem; /* Stor tittel */
            font-weight: bold;
            color: #a78bfa; /* Lys lilla */
            margin-bottom: 0.5rem;
        }

        .game-menu {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .game-button {
            background-image: linear-gradient(to right, #6366f1, #8b5cf6); /* Gradient-knapp */
            color: white;
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            text-align: center;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border: none;
            flex: 1 1 auto; /* Fleksibel bredde */
            max-width: 200px; /* Maks bredde for hver knapp */
        }

        .game-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        .game-area {
            background-color: #4b5563; /* Lysere grå for spillområdet */
            border-radius: 1rem;
            padding: 2rem;
            min-height: 300px; /* Minimum høyde for spillinnhold */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        /* Spesifikke stiler for "Gjett Tallet"-spillet */
        #guessTheNumberGame h2 {
            font-size: 2.25rem;
            font-weight: bold;
            color: #34d399; /* Grønn tittel for spillet */
            margin-bottom: 1.5rem;
        }

        #guessTheNumberGame input[type="number"] {
            background-color: #6b7280; /* Mørkere inputfelt */
            color: #f3f4f6;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            border: 1px solid #4b5563;
            width: 100%;
            max-width: 200px;
            margin-bottom: 1rem;
            text-align: center;
            font-size: 1.25rem;
        }

        #guessTheNumberGame button {
            background-image: linear-gradient(to right, #10b981, #059669); /* Grønn gradient knapp */
            color: white;
            border-radius: 0.5rem;
            padding: 0.75rem 1.25rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        #guessTheNumberGame button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        #guessTheNumberGame #gameMessage {
            margin-top: 1.5rem;
            font-size: 1.125rem;
            font-weight: 500;
        }

        #guessTheNumberGame #attemptsCount {
            margin-top: 0.5rem;
            font-size: 0.95rem;
            color: #d1d5db; /* Lysere grå tekst */
        }

        /* Spesifikke stiler for "Spørsmålsspill" */
        #questionGame h2 {
            font-size: 2.25rem;
            font-weight: bold;
            color: #fca311; /* Oransje tittel for spillet */
            margin-bottom: 1.5rem;
        }
        #questionGame #questionDisplay {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            color: #e0e7ff; /* Lysere tekst for spørsmål */
            min-height: 3em; /* Sikrer litt plass selv med kort spørsmål */
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #questionGame input[type="text"] {
            background-color: #6b7280;
            color: #f3f4f6;
            border-radius: 0.5rem;
            padding: 0.75rem 1rem;
            border: 1px solid #4b5563;
            width: 100%;
            max-width: 300px;
            margin-bottom: 1rem;
            text-align: center;
            font-size: 1.25rem;
            focus:outline-none focus:ring-2 focus:ring-yellow-500;
        }
        #questionGame .button-group button {
            background-image: linear-gradient(to right, #f59e0b, #d97706); /* Oransje gradient knapp */
            margin: 0.5rem;
        }
        #questionGame #scoreDisplay {
            margin-top: 1rem;
            font-size: 1rem;
            color: #d1d5db;
        }
        #questionGame #answerMessage {
            margin-top: 1rem;
            font-size: 1.125rem;
            font-weight: 500;
        }
        #leaderboard-container {
            background-color: #374151; /* Mørkere grå */
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-top: 2rem;
            width: 100%;
            max-width: 400px; /* Begrenset bredde for lesbarhet */
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
            text-align: left;
        }
        #leaderboard-container h3 {
            font-size: 1.75rem;
            font-weight: bold;
            color: #fca311; /* Oransje tittel */
            margin-bottom: 1rem;
            text-align: center;
        }
        #leaderboard-container ol {
            list-style: none; /* Fjern standard liste-prikker */
            padding: 0;
            margin: 0;
        }
        #leaderboard-container li {
            background-color: #4b5563; /* Litt lysere grå for liste-elementer */
            padding: 0.75rem 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
            color: #e0e7ff;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        #leaderboard-container li:last-child {
            margin-bottom: 0;
        }
        #leaderboard-container .leaderboard-score {
            font-weight: bold;
            color: #34d399; /* Grønn for poeng */
        }
        #nicknameInputContainer {
            margin-top: 1.5rem;
            background-color: #6b7280;
            padding: 1rem;
            border-radius: 0.5rem;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }
        #nicknameInputContainer input {
            background-color: #4b5563;
            border: 1px solid #374151;
            color: #f3f4f6;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }
        #nicknameInputContainer button {
            background-image: linear-gradient(to right, #8b5cf6, #a78bfa); /* Lilla gradient */
            padding: 0.5rem 1rem;
            border-radius: 0.25rem;
            font-weight: 500;
        }

        /* Spesifikke stiler for Retro Spill-seksjonen */
        .retro-game-menu {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 2rem;
            max-width: 600px; /* Passende bredde for retro-meny */
        }

        .retro-game-button {
            background-image: linear-gradient(to right, #06b6d4, #0ea5e9); /* Blå gradient */
            color: white;
            border-radius: 0.75rem;
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            text-align: center;
            transition: all 0.2s ease-in-out;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            border: none;
            flex: 1 1 auto;
            max-width: 180px;
        }

        .retro-game-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }

        /* Snake Game Canvas */
        #snakeCanvas {
            background-color: #1a4d2e; /* Mørk grønn for slangespillet */
            border: 2px solid #34d399;
            border-radius: 0.5rem;
            cursor: pointer;
        }
        #snakeGameControls {
            margin-top: 1.5rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            justify-content: center;
        }
        #snakeGameControls button {
            background-image: linear-gradient(to right, #a78bfa, #c084fc); /* Lilla gradient */
            color: white;
            border-radius: 0.5rem;
            padding: 0.75rem 1.25rem;
            font-weight: 600;
            transition: all 0.2s ease-in-out;
            border: none;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        #snakeGameControls button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
        }
        #snakeScore {
            margin-top: 1rem;
            font-size: 1.25rem;
            font-weight: bold;
            color: #34d399;
        }


        footer {
            text-align: center;
            margin-top: 2rem;
            font-size: 0.875rem;
            color: #9ca3af; /* Gråere tekst */
        }

        /* Responsivitet for små skjermer */
        @media (max-width: 640px) {
            .container {
                padding: 1.5rem;
                gap: 1.5rem;
            }
            h1 {
                font-size: 2.25rem;
            }
            #guessTheNumberGame h2, #questionGame h2 {
                font-size: 1.75rem;
            }
            .game-button, .retro-game-button {
                width: 100%;
                max-width: none;
            }
            #questionGame #questionDisplay {
                font-size: 1.25rem;
            }
            #questionGame input[type="text"] {
                max-width: 100%;
            }
            #snakeCanvas {
                width: 100%;
                height: auto; /* Justeres basert på aspect ratio */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Minispill for Tidsfordriv</h1>
            <p class="text-gray-300">Finn ditt favorittspill for å slappe av og ha det gøy!</p>
        </header>

        <nav class="game-menu">
            <button class="game-button" onclick="loadGame('guessTheNumber')">Gjett Tallet</button>
            <button class="game-button" onclick="loadGame('questionGame')">Spørsmålsspill</button>
            <button class="game-button" onclick="loadGame('retroGames')">Retro Spill</button>
            <button class="game-button" onclick="loadGame('anotherGame')" disabled>Et Annet Spill (kommer)</button>
            <!-- Legg til flere spillknapper her -->
        </nav>

        <main class="game-area" id="gameArea">
            <!-- Spillinnholdet vil lastes inn her via JavaScript -->
            <p class="text-xl text-gray-400">Velg et spill fra menyen over for å begynne!</p>
        </main>

        <footer>
            <p>&copy; 2025 Minispill. Alle rettigheter reservert.</p>
        </footer>
    </div>

    <script>
        // Referanse til spillområdet
        const gameArea = document.getElementById('gameArea');

        // Funksjon for å laste et spill inn i spillområdet
        function loadGame(gameName) {
            gameArea.innerHTML = ''; // Tømmer spillområdet
            // Stopp alle aktive spill-looper før et nytt spill lastes
            stopAllGameLoops();

            switch (gameName) {
                case 'guessTheNumber':
                    loadGuessTheNumberGame();
                    break;
                case 'questionGame':
                    loadQuestionGame();
                    break;
                case 'retroGames':
                    loadRetroGamesMenu();
                    break;
                case 'snakeGame': // Spesifikt for Snake, lastes fra retroGames menu
                    loadSnakeGame();
                    break;
                case 'anotherGame':
                    gameArea.innerHTML = '<h2 class="text-2xl text-yellow-400">Dette spillet kommer snart!</h2><p class="mt-2 text-gray-300">Følg med for mer moro.</p>';
                    break;
                default:
                    gameArea.innerHTML = '<p class="text-xl text-red-500">Ukjent spill.</p>';
            }
        }

        // Funksjon for å stoppe alle aktive spill-looper
        function stopAllGameLoops() {
            // Snake game loop
            if (snakeGameLoopId) {
                clearTimeout(snakeGameLoopId);
                snakeGameLoopId = null;
            }
            // Add other game loops here if they use requestAnimationFrame or setInterval/setTimeout
        }


        // --- Gjett Tallet-spillet ---
        function loadGuessTheNumberGame() {
            gameArea.innerHTML = `
                <div id="guessTheNumberGame" class="w-full max-w-md bg-gray-700 p-8 rounded-xl shadow-lg">
                    <h2 class="mb-6">Gjett Tallet!</h2>
                    <p class="text-lg mb-4">Jeg tenker på et tall mellom 1 og 100.</p>
                    <input type="number" id="guessInput" placeholder="Skriv inn ditt gjetning" min="1" max="100" class="focus:outline-none focus:ring-2 focus:ring-indigo-500">
                    <button onclick="checkGuess()" class="mt-4 w-full">Gjett!</button>
                    <p id="gameMessage" class="text-gray-200 mt-4"></p>
                    <p id="attemptsCount" class="text-gray-400"></p>
                    <button onclick="resetGuessTheNumberGame()" class="mt-6 bg-red-600 hover:bg-red-700 w-full">Start Nytt Spill</button>
                </div>
            `;

            // Initialiser spillvariabler for "Gjett Tallet"
            secretNumber = generateRandomNumber(1, 100);
            attempts = 0;
            updateGuessTheNumberUI();
            console.log("Secret number (for testing):", secretNumber); // Fjern denne i et ekte spill!
        }

        let secretNumber;
        let attempts;

        function generateRandomNumber(min, max) {
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function updateGuessTheNumberUI() {
            document.getElementById('attemptsCount').textContent = `Antall forsøk: ${attempts}`;
        }

        function checkGuess() {
            const guessInput = document.getElementById('guessInput');
            const gameMessage = document.getElementById('gameMessage');
            const guess = parseInt(guessInput.value);

            if (isNaN(guess) || guess < 1 || guess > 100) {
                gameMessage.textContent = "Vennligst skriv inn et gyldig tall mellom 1 og 100.";
                gameMessage.style.color = '#f87171'; /* rød */
                return;
            }

            attempts++;
            updateGuessTheNumberUI();

            if (guess === secretNumber) {
                gameMessage.textContent = `Gratulerer! Du gjettet riktig tall (${secretNumber}) på ${attempts} forsøk!`;
                gameMessage.style.color = '#34d399'; /* grønn */
                guessInput.disabled = true; // Deaktiver input etter vinner
            } else if (guess < secretNumber) {
                gameMessage.textContent = "For lavt! Prøv et høyere tall.";
                gameMessage.style.color = '#facc15'; /* gul */
            } else {
                gameMessage.textContent = "For høyt! Prøv et lavere tall.";
                gameMessage.style.color = '#facc15'; /* gul */
            }

            guessInput.value = ''; // Tøm inputfeltet
            guessInput.focus(); // Sett fokus tilbake til inputfeltet
        }

        function resetGuessTheNumberGame() {
            secretNumber = generateRandomNumber(1, 100);
            attempts = 0;
            document.getElementById('guessInput').value = '';
            document.getElementById('guessInput').disabled = false;
            document.getElementById('gameMessage').textContent = '';
            updateGuessTheNumberUI();
            console.log("Secret number (for testing):", secretNumber); // Fjern denne i et ekte spill!
        }

        // --- Spørsmålsspillet ---
        let questions = [];
        let currentQuestionIndex;
        let correctAnswers = 0;
        let totalQuestionsAsked = 0;
        const LEADERBOARD_KEY = 'questionGameLeaderboard'; // Nøkkel for localStorage

        // Shuffle function (Fisher-Yates)
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]]; // Swap elements
            }
        }

        function loadQuestionGame() {
            gameArea.innerHTML = `
                <div id="questionGame" class="w-full max-w-lg bg-gray-700 p-8 rounded-xl shadow-lg flex flex-col items-center">
                    <h2 class="mb-6">Spørsmålsspill!</h2>
                    <p id="questionDisplay" class="mb-4"></p>
                    <input type="text" id="answerInput" placeholder="Skriv inn ditt svar her" class="focus:outline-none focus:ring-2 focus:ring-yellow-500">
                    <div class="button-group flex justify-center mt-4">
                        <button onclick="checkQuestionAnswer()">Svar</button>
                        <button onclick="nextQuestion()" class="bg-gray-600 hover:bg-gray-500">Neste Spørsmål</button>
                    </div>
                    <p id="answerMessage" class="text-gray-200 mt-4"></p>
                    <p id="scoreDisplay" class="text-gray-400 mt-2">Poeng: 0 / 0</p>
                    <button onclick="resetQuestionGame()" class="mt-6 bg-red-600 hover:bg-red-700 w-full">Start Nytt Spill</button>
                </div>

                <div id="leaderboard-container" class="mt-8">
                    <h3>Resultatliste</h3>
                    <ol id="leaderboardList"></ol>
                </div>
            `;

            initializeQuestionGame();
            loadAndDisplayLeaderboard(); // Last og vis resultatliste ved oppstart
        }

        function initializeQuestionGame() {
            // Definer en stor spørsmålsbase
            const allQuestions = [
                { question: "Hva er hovedstaden i Norge?", answer: "Oslo" },
                { question: "Hvilket grunnstoff har kjemisk symbol 'O'?", answer: "Oksygen" },
                { question: "Hva heter verdens største hav?", answer: "Stillehavet" },
                { question: "Hvilken planet er kjent som 'Den røde planet'?", answer: "Mars" },
                { question: "Hvem skrev 'Peer Gynt'?", answer: "Henrik Ibsen" },
                { question: "Hvor mange dager er det i et skuddår?", answer: "366" },
                { question: "Hva er resultatet av 7 x 8?", answer: "56" },
                { question: "Hvilken fugl er et symbol for fred?", answer: "Due" },
                { question: "Hva heter den høyeste fjelltoppen i verden?", answer: "Mount Everest" },
                { question: "Hvilket dyr gir oss ull?", answer: "Sau" },
                { question: "Hva heter Norges lengste elv?", answer: "Glomma" },
                { question: "Hvilken farge får du hvis du blander blått og gult?", answer: "Grønn" },
                { question: "Hva heter det største organet i menneskekroppen?", answer: "Hud" },
                { question: "Hva heter valutaen i Japan?", answer: "Yen" },
                { question: "Hvilken sport bruker en puck?", answer: "Ishockey" },
                { question: "Hva er hovedstaden i Sverige?", answer: "Stockholm" },
                { question: "Hvilken måned har 28 dager (utenom skuddår)?", answer: "Februar" },
                { question: "Hva heter dyret som er en 'kongle-spiser'?", answer: "Eikenøtt" },
                { question: "Hva er motsatt av 'kald'?", answer: "Varm" },
                { question: "Hvilken by er kjent for Eiffeltårnet?", answer: "Paris" },
                { question: "Hva heter havnen i Bergen?", answer: "Bryggen" },
                { question: "Hvilket instrument har 88 tangenter?", answer: "Piano" },
                { question: "Hva er et annet navn for et 'sekskantet' objekt?", answer: "Heksagon" },
                { question: "Hvilken type frukt er en banan?", answer: "Bær" },
                { question: "Hva er den største ørkenen i verden?", answer: "Sahara" },
                { question: "Hvem malte 'Skrik'?", answer: "Edvard Munch" },
                { question: "Hva heter Norges nasjonalfugl?", answer: "Fossekall" },
                { question: "Hvor mange bein har en edderkopp?", answer: "8" },
                { question: "Hva er den offisielle hovedstaden i Canada?", answer: "Ottawa" },
                { question: "Hvilket hav skiller Europa og Afrika?", answer: "Middelhavet" },
                { question: "Hva heter fiktive karakteren som bor i en ananas under havet?", answer: "Svampebob Firkant" },
                { question: "Hva er det høyeste bygget i verden?", answer: "Burj Khalifa" },
                { question: "Hvilken farge er solsikker?", answer: "Gul" },
                { question: "Hva heter det første mennesket på månen?", answer: "Neil Armstrong" },
                { question: "Hvilket land er kjent for pizza og pasta?", answer: "Italia" },
                { question: "Hva er en gruppe løver kalt?", answer: "Stolthet" },
                { question: "Hvilken metall er flytende ved romtemperatur?", answer: "Kvikksølv" },
                { question: "Hva er hovedstaden i Tyskland?", answer: "Berlin" },
                { question: "Hva heter det største pattedyr i verden?", answer: "Blåhval" },
                { question: "Hva er det mest vanlige navnet i verden?", answer: "Mohammed" },
                { question: "Hva heter elven som renner gjennom London?", answer: "Themsen" },
                { question: "Hva er det minste landet i verden?", answer: "Vatikanstaten" },
                { question: "Hva heter den største øya i verden?", answer: "Grønland" },
                { question: "Hva er hovedingrediensen i guacamole?", answer: "Avocado" },
                { question: "Hvilken planet er nærmest solen?", answer: "Mercur" },
                { question: "Hva er det kjemiske symbolet for vann?", answer: "H2O" },
                { question: "Hvilken farge er himmelen på en klar dag?", answer: "Blå" },
                { question: "Hvilket dyr er kjent for å bygge demninger?", answer: "Bever" },
                { question: "Hva heter sporten der man kaster en javelin?", answer: "Spydkast" },
                { question: "Hvilken del av et tre leder vann opp til bladene?", answer: "Stamme" }
            ];

            questions = [...allQuestions]; // Lag en kopi
            shuffleArray(questions);
            currentQuestionIndex = -1; // Start før første spørsmål
            correctAnswers = 0;
            totalQuestionsAsked = 0;
            nextQuestion(); // Last inn det første spørsmålet
            updateQuestionScore();
        }

        function displayQuestion() {
            const questionDisplay = document.getElementById('questionDisplay');
            const answerInput = document.getElementById('answerInput');
            const answerMessage = document.getElementById('answerMessage');

            // Skjul eventuell input for kallenavn
            const nicknameInputContainer = document.getElementById('nicknameInputContainer');
            if (nicknameInputContainer) {
                nicknameInputContainer.remove();
            }

            if (currentQuestionIndex < questions.length) {
                questionDisplay.textContent = questions[currentQuestionIndex].question;
                answerInput.value = '';
                answerInput.disabled = false;
                answerMessage.textContent = '';
                answerInput.focus();
            } else {
                // Spill slutt
                questionDisplay.textContent = `Spillet er ferdig! Du svarte riktig på ${correctAnswers} av ${totalQuestionsAsked} spørsmål.`;
                answerInput.disabled = true;
                answerMessage.textContent = '';

                // Sjekk om poengsummen er god nok for resultatlisten
                loadAndDisplayLeaderboard(); // Last for å få siste liste
                const currentLeaderboard = getLeaderboard();
                const lowestScoreOnLeaderboard = currentLeaderboard.length < 5 ? -1 : currentLeaderboard[currentLeaderboard.length - 1].score;

                if (correctAnswers > lowestScoreOnLeaderboard) {
                    showNicknameInput();
                } else {
                    setTimeout(() => {
                        answerMessage.textContent = "Prøv igjen for å komme på resultatlisten!";
                        answerMessage.style.color = '#facc15'; // Gul
                    }, 1000);
                }
            }
        }

        function checkQuestionAnswer() {
            const answerInput = document.getElementById('answerInput');
            const answerMessage = document.getElementById('answerMessage');
            const userAnswer = answerInput.value.trim().toLowerCase();
            const correctAnswer = questions[currentQuestionIndex].answer.trim().toLowerCase();

            // Sjekk om svar allerede er gitt for dette spørsmålet
            if (answerInput.disabled) {
                return;
            }

            totalQuestionsAsked++; // Teller antall spørsmål besvart

            if (userAnswer === correctAnswer) {
                answerMessage.textContent = "Riktig svar! 🎉";
                answerMessage.style.color = '#34d399'; /* grønn */
                correctAnswers++;
            } else {
                answerMessage.textContent = `Feil svar. Svaret var: ${questions[currentQuestionIndex].answer}`;
                answerMessage.style.color = '#f87171'; /* rød */
            }
            answerInput.disabled = true; // Deaktiver input etter svar
            updateQuestionScore();
        }

        function nextQuestion() {
            const answerMessage = document.getElementById('answerMessage');
            const answerInput = document.getElementById('answerInput');

            // Hvis spørsmål ikke er svart på, tell det som feil
            if (currentQuestionIndex >= 0 && !answerInput.disabled && currentQuestionIndex < questions.length) {
                 totalQuestionsAsked++;
                 answerMessage.textContent = `Du hoppet over dette. Svaret var: ${questions[currentQuestionIndex].answer}`;
                 answerMessage.style.color = '#facc15'; /* gul */
                 updateQuestionScore();
            }

            currentQuestionIndex++;
            displayQuestion();
        }

        function updateQuestionScore() {
            document.getElementById('scoreDisplay').textContent = `Poeng: ${correctAnswers} / ${totalQuestionsAsked}`;
        }

        function resetQuestionGame() {
            initializeQuestionGame();
            document.getElementById('answerMessage').textContent = '';
        }

        // --- Resultatliste (Leaderboard) funksjoner ---
        function getLeaderboard() {
            const leaderboardJson = localStorage.getItem(LEADERBOARD_KEY);
            return leaderboardJson ? JSON.parse(leaderboardJson) : [];
        }

        function saveLeaderboard(leaderboardData) {
            localStorage.setItem(LEADERBOARD_KEY, JSON.stringify(leaderboardData));
        }

        function addScoreToLeaderboard(nickname, score, total) {
            let leaderboard = getLeaderboard();
            leaderboard.push({ nickname: nickname, score: score, totalQuestions: total });

            // Sorter etter poeng (synkende), deretter etter totalt antall spørsmål (stigende for å bryte bånd)
            leaderboard.sort((a, b) => {
                if (b.score !== a.score) {
                    return b.score - a.score;
                }
                return a.totalQuestions - b.totalQuestions; // Færre spørsmål for samme score vinner
            });

            // Behold kun de 5 beste
            leaderboard = leaderboard.slice(0, 5);
            saveLeaderboard(leaderboard);
            loadAndDisplayLeaderboard(); // Oppdater visningen
        }

        function loadAndDisplayLeaderboard() {
            const leaderboardList = document.getElementById('leaderboardList');
            if (!leaderboardList) return; // Sjekk om elementet eksisterer

            const leaderboard = getLeaderboard();
            leaderboardList.innerHTML = ''; // Tømmer listen

            if (leaderboard.length === 0) {
                leaderboardList.innerHTML = '<li class="text-center text-gray-400">Ingen resultater ennå. Spill for å komme på listen!</li>';
                return;
            }

            leaderboard.forEach((entry, index) => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <span>${index + 1}. ${entry.nickname}</span>
                    <span class="leaderboard-score">${entry.score} / ${entry.totalQuestions}</span>
                `;
                leaderboardList.appendChild(listItem);
            });
        }

        function showNicknameInput() {
            const questionGameDiv = document.getElementById('questionGame');
            const nicknameInputContainer = document.createElement('div');
            nicknameInputContainer.id = 'nicknameInputContainer';
            nicknameInputContainer.className = 'mt-6 bg-gray-600 p-4 rounded-lg shadow-md w-full max-w-md'; // Mindre enn spillets div
            nicknameInputContainer.innerHTML = `
                <p class="text-white mb-2">Gratulerer! Skriv inn ditt kallenavn for resultatlisten:</p>
                <input type="text" id="nicknameInput" placeholder="Kallenavn" class="w-full mb-2">
                <button onclick="submitNickname()" class="w-full">Lagre Poengsum</button>
            `;
            questionGameDiv.appendChild(nicknameInputContainer);
            document.getElementById('nicknameInput').focus();
        }

        function submitNickname() {
            const nicknameInput = document.getElementById('nicknameInput');
            let nickname = nicknameInput.value.trim();

            if (nickname === "") {
                nickname = "Anonym"; // Standard kallenavn hvis tom
            }

            addScoreToLeaderboard(nickname, correctAnswers, totalQuestionsAsked);

            // Fjern kallenavninput og gi tilbakemelding
            const nicknameInputContainer = document.getElementById('nicknameInputContainer');
            if (nicknameInputContainer) {
                nicknameInputContainer.remove();
            }
            const answerMessage = document.getElementById('answerMessage');
            answerMessage.textContent = `Poengsum lagret under ${nickname}!`;
            answerMessage.style.color = '#34d399'; // Grønn
        }

        // --- Retro Games Menu ---
        function loadRetroGamesMenu() {
            gameArea.innerHTML = `
                <div class="retro-game-menu">
                    <button class="retro-game-button" onclick="loadGame('snakeGame')">Snake</button>
                    <button class="retro-game-button" disabled>Tetris Lite (kommer)</button>
                    <button class="retro-game-button" disabled>Pac-Man Lite (kommer)</button>
                    <button class="retro-game-button" disabled>Asteroids Lite (kommer)</button>
                </div>
            `;
        }

        // --- Snake Game ---
        let snakeCanvas, snakeCtx;
        const GRID_SIZE = 20; // Size of each square in the grid
        let snake = [{ x: 10, y: 10 }];
        let food = {};
        let dx = 0; // x velocity
        let dy = 0; // y velocity
        let score = 0;
        let changingDirection = false;
        let snakeGameLoopId = null; // To store setTimeout ID for pausing/resetting

        function loadSnakeGame() {
            gameArea.innerHTML = `
                <div id="snakeGame" class="w-full max-w-lg bg-gray-800 p-6 rounded-xl shadow-lg flex flex-col items-center">
                    <h2 class="text-2xl font-bold text-blue-400 mb-4">Snake</h2>
                    <canvas id="snakeCanvas" width="400" height="400"></canvas>
                    <div id="snakeGameControls" class="mt-4">
                        <button onclick="startGame()">Start Spill</button>
                        <button onclick="pauseGame()">Pause/Fortsett</button>
                        <button onclick="resetSnakeGame()">Nytt Spill</button>
                    </div>
                    <p id="snakeScore" class="mt-4">Poeng: 0</p>
                </div>
            `;
            snakeCanvas = document.getElementById('snakeCanvas');
            snakeCtx = snakeCanvas.getContext('2d');
            resetSnakeGame(); // Initialize game state
            document.addEventListener('keydown', changeDirection); // Listen for arrow keys
        }

        function createFood() {
            food = {
                x: Math.floor(Math.random() * (snakeCanvas.width / GRID_SIZE)),
                y: Math.floor(Math.random() * (snakeCanvas.height / GRID_SIZE))
            };
            // Ensure food does not spawn on the snake
            snake.forEach(part => {
                if (part.x === food.x && part.y === food.y) {
                    createFood(); // Recurse if food is on snake
                }
            });
        }

        function drawSnakePart(snakePart) {
            snakeCtx.fillStyle = '#34d399'; /* Lys grønn */
            snakeCtx.strokeStyle = '#10b981'; /* Mørkere grønn */
            snakeCtx.fillRect(snakePart.x * GRID_SIZE, snakePart.y * GRID_SIZE, GRID_SIZE, GRID_SIZE);
            snakeCtx.strokeRect(snakePart.x * GRID_SIZE, snakePart.y * GRID_SIZE, GRID_SIZE, GRID_SIZE);
        }

        function drawFood() {
            snakeCtx.fillStyle = '#f87171'; /* Rød */
            snakeCtx.strokeStyle = '#ef4444'; /* Mørkere rød */
            snakeCtx.fillRect(food.x * GRID_SIZE, food.y * GRID_SIZE, GRID_SIZE, GRID_SIZE);
            snakeCtx.strokeRect(food.x * GRID_SIZE, food.y * GRID_SIZE, GRID_SIZE, GRID_SIZE);
        }

        function draw() {
            snakeCtx.clearRect(0, 0, snakeCanvas.width, snakeCanvas.height);
            drawFood();
            snake.forEach(drawSnakePart);
        }

        function advanceSnake() {
            if (!snakeGameLoopId && (dx === 0 && dy === 0)) return; // Game paused/not started

            const head = { x: snake[0].x + dx, y: snake[0].y + dy };

            // Check for collision with walls or self
            if (
                head.x < 0 || head.x * GRID_SIZE >= snakeCanvas.width ||
                head.y < 0 || head.y * GRID_SIZE >= snakeCanvas.height ||
                checkCollision(head)
            ) {
                gameOver();
                return;
            }

            snake.unshift(head); // Add new head

            const didEatFood = head.x === food.x && head.y === food.y;
            if (didEatFood) {
                score += 10;
                document.getElementById('snakeScore').textContent = `Poeng: ${score}`;
                createFood(); // Create new food
            } else {
                snake.pop(); // Remove tail if no food eaten
            }
            changingDirection = false;
        }

        function checkCollision(head) {
            // Check if snake head collides with any part of its body
            for (let i = 1; i < snake.length; i++) {
                if (head.x === snake[i].x && head.y === snake[i].y) return true;
            }
            return false;
        }

        function changeDirection(event) {
            const LEFT_KEY = 37;
            const RIGHT_KEY = 39;
            const UP_KEY = 38;
            const DOWN_KEY = 40;

            if (changingDirection) return; // Prevent rapid multiple key presses
            changingDirection = true;

            const keyPressed = event.keyCode;
            const goingUp = dy === -1;
            const goingDown = dy === 1;
            const goingLeft = dx === -1;
            const goingRight = dx === 1;

            if (keyPressed === LEFT_KEY && !goingRight) {
                dx = -1;
                dy = 0;
            }
            if (keyPressed === UP_KEY && !goingDown) {
                dx = 0;
                dy = -1;
            }
            if (keyPressed === RIGHT_KEY && !goingLeft) {
                dx = 1;
                dy = 0;
            }
            if (keyPressed === DOWN_KEY && !goingUp) {
                dx = 0;
                dy = 1;
            }
        }

        function gameLoop() {
            snakeGameLoopId = setTimeout(function onTick() {
                advanceSnake();
                draw();
                gameLoop(); // Call itself recursively
            }, 100); // Game speed (lower is faster)
        }

        function startGame() {
            if (snakeGameLoopId === null) { // Only start if not already running
                if (dx === 0 && dy === 0) { // If game just reset or never started, give initial direction
                     dx = 1; // Start moving right
                }
                gameLoop();
            }
        }

        function pauseGame() {
            if (snakeGameLoopId) {
                clearTimeout(snakeGameLoopId);
                snakeGameLoopId = null;
            } else {
                startGame(); // Resume
            }
        }

        function resetSnakeGame() {
            clearTimeout(snakeGameLoopId); // Stop current game loop
            snakeGameLoopId = null;
            snake = [{ x: 10, y: 10 }]; // Reset snake position
            dx = 0; // Reset direction
            dy = 0;
            score = 0;
            document.getElementById('snakeScore').textContent = `Poeng: ${score}`;
            createFood(); // Place new food
            draw(); // Initial draw
        }

        function gameOver() {
            clearTimeout(snakeGameLoopId);
            snakeGameLoopId = null;
            alert("Game Over! Ditt poeng: " + score); // Simple alert for now
            resetSnakeGame();
        }

        // Laster "Gjett Tallet"-spillet automatisk når siden lastes som standard
        window.onload = () => loadGame('guessTheNumber');

    </script>
</body>
</html>
